"use strict";(()=>{var e={};e.id=4,e.ids=[4],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},2697:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>P,requestAsyncStorage:()=>h,routeModule:()=>E,serverHooks:()=>_,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>m,runtime:()=>c});var o=t(9303),n=t(8716),a=t(3131),i=t(7070),p=t(3114),u=t(1979),d=t(9064);let c="nodejs",l=new p.Z(process.env.STRIPE_SECRET_KEY||"",{apiVersion:"2024-06-20"});async function m(e){let r;let t=e.headers.get("stripe-signature");if(!t)return i.NextResponse.json({error:"Missing signature"},{status:400});let s=await e.text();try{r=l.webhooks.constructEvent(s,t,process.env.STRIPE_WEBHOOK_SECRET||"")}catch(e){return i.NextResponse.json({error:`Webhook Error: ${e.message}`},{status:400})}if("checkout.session.completed"===r.type)try{let e=r.data.object,t=e.metadata?.plan||"30d",s=u.D[t],o=e.metadata?.order_id;if(o){let e=(0,d.S)();await e.from("orders").update({status:"paid",token_grant:s}).eq("id",o)}}catch{}return i.NextResponse.json({received:!0})}let E=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payments/webhook/route",pathname:"/api/payments/webhook",filename:"route",bundlePath:"app/api/payments/webhook/route"},resolvedPagePath:"C:\\Users\\mertk\\Desktop\\BLOOMY\\figma\\app\\api\\payments\\webhook\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:_}=E,v="/api/payments/webhook/route";function P(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:x})}},1979:(e,r,t)=>{t.d(r,{D:()=>s,F:()=>o});let s={"30d":100,"365d":1e3};function o(e){return"30d"===e?process.env.NEXT_PUBLIC_STRIPE_PRICE_30D:"365d"===e?process.env.NEXT_PUBLIC_STRIPE_PRICE_365D:void 0}},9064:(e,r,t)=>{t.d(r,{S:()=>o});var s=t(9498);function o(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Supabase admin envs missing");return(0,s.eI)(e,r)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[633,498,972,114],()=>t(2697));module.exports=s})();